-- CustomGui.lua
-- Simple Roblox GUI library supporting mobile and multi-select dropdowns
-- Usage: require(path_to_CustomGui)

local CustomGui = {}

function CustomGui:CreateWindow(props)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = props.Name or "CustomWindow"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")

    -- Main frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0.8, 0, 0.8, 0)
    mainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.Parent = screenGui
    mainFrame.ClipsDescendants = true
    mainFrame.AnchorPoint = Vector2.new(0,0)
    mainFrame.ZIndex = 1

    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 16)
    uiCorner.Parent = mainFrame

    -- Top bar (draggable, closable)
    local topBar = Instance.new("Frame")
    topBar.Name = "TopBar"
    topBar.Size = UDim2.new(1, 0, 0, 40)
    topBar.Position = UDim2.new(0, 0, 0, 0)
    topBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    topBar.Parent = mainFrame
    local topCorner = Instance.new("UICorner")
    topCorner.CornerRadius = UDim.new(0, 16)
    topCorner.Parent = topBar

    local title = Instance.new("TextLabel")
    title.Text = props.Name or "CustomWindow"
    title.Size = UDim2.new(1, -40, 1, 0)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(255,255,255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 22
    title.Parent = topBar
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Padding = Enum.TextXAlignment.Left
    title.TextWrapped = true

    local closeBtn = Instance.new("TextButton")
    closeBtn.Text = "âœ•"
    closeBtn.Size = UDim2.new(0, 40, 1, 0)
    closeBtn.Position = UDim2.new(1, -40, 0, 0)
    closeBtn.BackgroundTransparency = 1
    closeBtn.TextColor3 = Color3.fromRGB(255,80,80)
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 28
    closeBtn.Parent = topBar
    closeBtn.ZIndex = 2
    closeBtn.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)

    -- Dragging logic
    local dragging, dragInput, dragStart, startPos
    topBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
        end
    end)
    topBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    topBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    -- Scrollable content
    local scroll = Instance.new("ScrollingFrame")
    scroll.Name = "Scroll"
    scroll.Size = UDim2.new(1, 0, 1, -40)
    scroll.Position = UDim2.new(0, 0, 0, 40)
    scroll.CanvasSize = UDim2.new(0, 0, 0, 800)
    scroll.ScrollBarThickness = 10
    scroll.BackgroundTransparency = 1
    scroll.Parent = mainFrame
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.ScrollingDirection = Enum.ScrollingDirection.Y

    local layout = Instance.new("UIListLayout")
    layout.Parent = scroll
    layout.Padding = UDim.new(0, 18)
    layout.SortOrder = Enum.SortOrder.LayoutOrder

    return scroll
end

function CustomGui:CreateTab(parent, props)
    -- Just return parent (scroll) for simplicity, all controls go in scroll
    return parent
end

function CustomGui:AddSection(parent, props)
    local section = Instance.new("Frame")
    section.Size = UDim2.new(0.98, 0, 0, 44)
    section.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    section.BackgroundTransparency = 0.15
    section.Parent = parent
    section.LayoutOrder = parent:GetChildren() and #parent:GetChildren() or 1
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 12)
    uiCorner.Parent = section
    local label = Instance.new("TextLabel")
    label.Text = props.Name or "Section"
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 24
    label.Parent = section
    label.AnchorPoint = Vector2.new(0.5,0.5)
    label.Position = UDim2.new(0.5,0,0.5,0)
    return section
end

function CustomGui:AddLabel(parent, text)
    local label = Instance.new("TextLabel")
    label.Text = text
    label.Size = UDim2.new(0.98, 0, 0, 28)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(200,200,200)
    label.Font = Enum.Font.Gotham
    label.TextSize = 18
    label.Parent = parent
    label.LayoutOrder = parent:GetChildren() and #parent:GetChildren() or 1
    return label
end

function CustomGui:AddToggle(parent, props)
    local button = Instance.new("TextButton")
    button.Text = props.Name or "Toggle"
    button.Size = UDim2.new(0.98, 0, 0, 36)
    button.BackgroundColor3 = Color3.fromRGB(60, 180, 75)
    button.TextColor3 = Color3.fromRGB(255,255,255)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 20
    button.Parent = parent
    button.LayoutOrder = parent:GetChildren() and #parent:GetChildren() or 1
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 8)
    uiCorner.Parent = button
    local state = props.Default or false
    button.MouseButton1Click:Connect(function()
        state = not state
        button.BackgroundColor3 = state and Color3.fromRGB(60, 180, 75) or Color3.fromRGB(180, 60, 60)
        if props.Callback then props.Callback(state) end
    end)
    return button
end

function CustomGui:AddSlider(parent, props)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(0.98, 0, 0, 44)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Parent = parent
    sliderFrame.LayoutOrder = parent:GetChildren() and #parent:GetChildren() or 1
    local slider = Instance.new("TextButton")
    slider.Size = UDim2.new(0.9, 0, 0, 36)
    slider.Position = UDim2.new(0.05, 0, 0, 4)
    slider.BackgroundColor3 = Color3.fromRGB(100,100,255)
    slider.TextColor3 = Color3.fromRGB(255,255,255)
    slider.Font = Enum.Font.Gotham
    slider.TextSize = 18
    slider.Text = props.Name .. ": " .. tostring(props.Default or props.Min)
    slider.Parent = sliderFrame
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 8)
    uiCorner.Parent = slider
    local value = props.Default or props.Min
    slider.MouseButton1Click:Connect(function()
        value = value + (props.Increment or 0.1)
        if value > props.Max then value = props.Min end
        slider.Text = props.Name .. ": " .. string.format("%.2f", value)
        if props.Callback then props.Callback(value) end
    end)
    return sliderFrame
end

function CustomGui:AddMultiDropdown(parent, props)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.98, 0, 0, 44 + 32 * #props.Options)
    frame.BackgroundColor3 = Color3.fromRGB(38,38,38)
    frame.BackgroundTransparency = 0.18
    frame.Parent = parent
    frame.LayoutOrder = parent:GetChildren() and #parent:GetChildren() or 1
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 8)
    uiCorner.Parent = frame
    local label = Instance.new("TextLabel")
    label.Text = props.Name or "Dropdown"
    label.Size = UDim2.new(1, 0, 0, 28)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 18
    label.Parent = frame
    local selected = {}
    for i, option in ipairs(props.Options) do
        local optBtn = Instance.new("TextButton")
        optBtn.Text = option
        optBtn.Size = UDim2.new(0.96, 0, 0, 28)
        optBtn.Position = UDim2.new(0.02, 0, 0, 28 + 32 * (i-1))
        optBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
        optBtn.TextColor3 = Color3.fromRGB(255,255,255)
        optBtn.Font = Enum.Font.Gotham
        optBtn.TextSize = 16
        optBtn.Parent = frame
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 6)
        btnCorner.Parent = optBtn
        optBtn.MouseButton1Click:Connect(function()
            if table.find(selected, option) then
                for idx, val in ipairs(selected) do
                    if val == option then table.remove(selected, idx) break end
                end
                optBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
            else
                table.insert(selected, option)
                optBtn.BackgroundColor3 = Color3.fromRGB(60,180,75)
            end
            if props.Callback then props.Callback(selected) end
        end)
    end
    return frame
end

return CustomGui
